'use strict';
HTMLWidgets.widget({
  name: 'rhtmlMoonPlot',
  type: 'output',
  initialize: function(el, width, height) {
    console.log('rhtmlMoonPlot: Initialized');
    console.log("rhtmlMoonPlot: Given width " + width);
    console.log("rhtmlMoonPlot: Given height " + height);
    return new MoonPlot(width, height);
  },
  resize: function(el, width, height, instance) {
    console.log('rhtmlMoonPlot: Resized');
    instance.redraw(width, height, el);
    return instance;
  },
  renderValue: function(el, params, instance) {
    var i, lunarCoreLabels, lunarSurfaceLabels, lunarSurfaceSizes;
    console.log('rhtmlMoonPlot: RenderValue called');
    if (!params.lunarCoreLabels) {
      params = testData;
    }

    // params = busyCoreLabels
    // params = groceryStoreMarketResearch
    // params = softdrinkPreferences
    params = softdrinkSentinmentByAge

    normalizeCoreNodes(params.lunarCoreNodes);
    lunarSurfaceSizes = calculateSurfaceLabelSizes(params.lunarSurfaceNodes, 1.5, 0.5);
    calculateSurfaceNodePositions(params.lunarSurfaceNodes);
    lunarCoreLabels = [];
    lunarSurfaceLabels = [];
    i = 0;


    while (i < params.lunarCoreLabels.length) {
      lunarCoreLabels.push({
        name: params.lunarCoreLabels[i],
        x: params.lunarCoreNodes[i][0],
        y: params.lunarCoreNodes[i][1]
      });
      i++;
    }
    i = 0;
    while (i < params.lunarSurfaceLabels.length) {
      lunarSurfaceLabels.push({
        name: params.lunarSurfaceLabels[i],
        x: params.lunarSurfaceNodes[i][0],
        y: params.lunarSurfaceNodes[i][1],
        size: lunarSurfaceSizes[i]
      });
      i++;
    }
    this.data = {
      lunarSurfaceLabels: lunarSurfaceLabels,
      lunarCoreLabels: lunarCoreLabels
    };
    instance.draw(this.data, el);

    setTimeout(() => instance.redraw(500,500,el), 5000)
    setTimeout(() => instance.redraw(750,750,el), 10000)
    setTimeout(() => instance.redraw(1000,1000,el), 15000)

    return instance;
  }
});

var busyCoreLabels = {
  "lunarCoreNodes": [
    [
      "-1.463366472005000000000000000000",
      "-0.379352165370800000000000000000"
    ],
    [
      "-1.235356551405000000000000000000",
      "1.696363946463000000000000000000"
    ],
    [
      "-1.150392959552000000000000000000",
      "-0.752151664016300000000000000000"
    ],
    [
      "-1.413409716576000000000000000000",
      "-0.840777563639200000000000000000"
    ],
    [
      "-1.490651161978000000000000000000",
      "-1.490058965443000000000000000000"
    ],
    [
      "-0.928856779784000000000000000000",
      "1.723226724213000000000000000000"
    ],
    [
      "-1.461162275175000000000000000000",
      "0.293618220166700000000000000000"
    ],
    [
      "-0.428112309971200000000000000000",
      "1.560886527962000000000000000000"
    ],
    [
      "-1.483539795699000000000000000000",
      "-1.246236216518000000000000000000"
    ],
    [
      "-1.035105971734000000000000000000",
      "0.270154921828800000000000000000"
    ],
    [
      "-0.694026572196700000000000000000",
      "1.648646761036000000000000000000"
    ],
    [
      "-0.614401606572600000000000000000",
      "-0.283179409999600000000000000000"
    ],
    [
      "-0.600334034093100000000000000000",
      "-0.152239638535000000000000000000"
    ],
    [
      "-0.662460301569200000000000000000",
      "-1.072354472868000000000000000000"
    ],
    [
      "-0.505413978112300000000000000000",
      "-1.107138576830000000000000000000"
    ],
    [
      "-0.530714629472900000000000000000",
      "-1.174797044544000000000000000000"
    ],
    [
      "-0.279776133843700000000000000000",
      "2.667682152992000000000000000000"
    ],
    [
      "-0.536309006576800000000000000000",
      "0.237641739869500000000000000000"
    ],
    [
      "-0.087416865554500000000000000000",
      "-0.145884367803600000000000000000"
    ],
    [
      "-0.197088684239300000000000000000",
      "-1.214826577173000000000000000000"
    ],
    [
      "-0.038906068056090000000000000000",
      "1.120051731034000000000000000000"
    ],
    [
      "0.133041820941700000000000000000",
      "1.140746332418000000000000000000"
    ],
    [
      "0.182437580250000000000000000000",
      "0.870365405141200000000000000000"
    ],
    [
      "0.243117520135400000000000000000",
      "-0.520323394923400000000000000000"
    ],
    [
      "0.596267863557800000000000000000",
      "0.312351981803600000000000000000"
    ],
    [
      "0.925771780320700000000000000000",
      "0.712688210696400000000000000000"
    ],
    [
      "0.495089869610500000000000000000",
      "-1.409354792266000000000000000000"
    ],
    [
      "1.500520625135000000000000000000",
      "1.192577563219000000000000000000"
    ],
    [
      "0.771534817626900000000000000000",
      "0.536753213791800000000000000000"
    ],
    [
      "0.547511903605100000000000000000",
      "0.352335762863300000000000000000"
    ],
    [
      "0.756945359479000000000000000000",
      "0.201980091358100000000000000000"
    ],
    [
      "1.224315574928000000000000000000",
      "-0.713986429680700000000000000000"
    ],
    [
      "0.805760900560400000000000000000",
      "-0.462433930967200000000000000000"
    ],
    [
      "0.764355235597600000000000000000",
      "-1.064628191382000000000000000000"
    ],
    [
      "0.821497889673300000000000000000",
      "-1.360865293643000000000000000000"
    ],
    [
      "1.641650312930000000000000000000",
      "-0.254001592034900000000000000000"
    ],
    [
      "2.025627143634000000000000000000",
      "0.221032641613100000000000000000"
    ],
    [
      "1.146020979644000000000000000000",
      "-0.006234673891588000000000000000"
    ],
    [
      "1.139169270299000000000000000000",
      "-0.208230171069800000000000000000"
    ],
    [
      "1.208417377039000000000000000000",
      "-0.201231445288500000000000000000"
    ],
    [
      "1.589810627247000000000000000000",
      "0.543439010067300000000000000000"
    ],
    [
      "1.965506694775000000000000000000",
      "-0.229969450459200000000000000000"
    ]
  ],
  "lunarSurfaceNodes": [
    [
      "-0.089228875276690000000000000",
      "-1.495366049410000000000000000"
    ],
    [
      "1.274513486226000000000000000",
      "0.414829078874100000000000000"
    ],
    [
      "-1.207157718790000000000000000",
      "0.385839008768300000000000000"
    ],
    [
      "1.719968486478000000000000000",
      "0.550632044977400000000000000"
    ],
    [
      "1.127904081587000000000000000",
      "-0.373375992870200000000000000"
    ],
    [
      "-0.231472044464100000000000000",
      "-0.382599557578700000000000000"
    ],
    [
      "-0.656078953943200000000000000",
      "-1.110192375426000000000000000"
    ],
    [
      "-0.704289195138400000000000000",
      "2.593939724301000000000000000"
    ],
    [
      "0.497429018331800000000000000",
      "-0.179500861736300000000000000"
    ],
    [
      "-0.649491655085500000000000000",
      "0.578096833089100000000000000"
    ],
    [
      "-0.254979960849500000000000000",
      "-0.239828189956200000000000000"
    ],
    [
      "-0.876898104611200000000000000",
      "1.860835671888000000000000000"
    ],
    [
      "-0.520153154417500000000000000",
      "0.017025965259180000000000000"
    ],
    [
      "-1.790348968178000000000000000",
      "-1.446248139917000000000000000"
    ],
    [
      "1.601830460378000000000000000",
      "-0.575895421910000000000000000"
    ]
  ],
  "lunarCoreLabels": [
    "Porsche",
    "Nike athletic shoes",
    "Mercedes",
    "Lexus",
    "Calvin Klein perfume",
    "Reebok athletic shoes",
    "Guess jeans",
    "Levi 's jeans",
    "American Express",
    "Three mobile phone network",
    "Michelin tires",
    "Visa",
    "Foxtel cable",
    "IBM computers",
    "Sony televisions",
    "Apple computers",
    "Lee jeans",
    "Telstra",
    "Qantas",
    "Revlon cosmetics",
    "Toyota",
    "Pepsi Cola",
    "Diet Coke",
    "SBS TV",
    "Kettle chips",
    "Thins chips",
    "Oil of Olay lotion",
    "Cheezels",
    "McDonald's",
    "Kodak film",
    "Mattel toys",
    "Avon cosmetics",
    "Cadbury s chocolate",
    "ABC radio",
    "Hallmark cards",
    "Arnott's",
    "Coco Pops",
    "Lego",
    "Panadol pain reliever",
    "Colgate toothpaste",
    "Kmart",
    "Campbell's soup"
  ],
  "lunarSurfaceLabels": [
    "Charming",
    "Cheerful",
    "Daring",
    "Down.to.earth",
    "Honest",
    "Imaginative",
    "Intelligent",
    "Outdoorsy",
    "Reliable",
    "Spirited",
    "Successful",
    "Tough",
    "Up.to.date",
    "Upper.class",
    "Wholesome"
  ]
}

var groceryStoreMarketResearch = {
  "lunarCoreNodes": [
    [
      -0.0761,
      0.0141
    ],
    [
      -0.1456,
      0.0026
    ],
    [
      0.4265,
      0.1114
    ],
    [
      0.2186,
      -0.238
    ],
    [
      -0.0989,
      -0.0037
    ],
    [
      -0.1175,
      -0.0499
    ],
    [
      -0.1202,
      0.1251
    ]
  ],
  "lunarCoreLabels": [
    "Coles",
    "Woolworths",
    "Aldi",
    "Costco",
    "Harris Farm",
    "Foodland",
    "IGA"
  ],
  "lunarSurfaceNodes": [
    [
      2.0758,
      -0.0107
    ],
    [
      -0.4699,
      1.78
    ],
    [
      -0.6889,
      -1.2528
    ],
    [
      -0.5752,
      0.373
    ],
    [
      -0.2003,
      -0.6211
    ]
  ],
  "lunarSurfaceLabels": [
    "Price",
    "Access",
    "Range",
    "Fresh",
    "Quality"
  ]
}

var softdrinkPreferences = {
  "lunarCoreNodes": [
    [
      -0.6735,
      -0.0504
    ],
    [
      0.1935,
      -0.216
    ],
    [
      -0.0126,
      -0.0834
    ],
    [
      -0.0172,
      0.3187
    ],
    [
      0.4902,
      0.0248
    ],
    [
      0.0196,
      0.0062
    ]
  ],
  "lunarCoreLabels": [
    "Coca-Cola",
    "Diet Coke",
    "Coke Zero",
    "Pepsi",
    "Diet Pepsi",
    "Pepsi Max"
  ],
  "lunarSurfaceNodes": [
    [
      0.3341,
      -0.0985
    ],
    [
      0.3452,
      -0.2147
    ],
    [
      0.2381,
      0.1676
    ],
    [
      -0.56,
      -0.1882
    ],
    [
      -0.2995,
      0.1163
    ]
  ],
  "lunarSurfaceLabels": [
    "Hate",
    "Dislike",
    "Neither like nor dislike",
    "Love",
    "Like"
  ]
}

var softdrinkSentinmentByAge = {
  "lunarCoreNodes": [
    [
      0.1722,
      -0.0751,
      0.2017,
      0.0228,
      -0.0343,
      0.0273,
      -0.0042
    ],
    [
      -0.1279,
      0.6533,
      -0.0244,
      0.0481,
      -0.0763,
      -0.0172,
      0.0357
    ],
    [
      -0.1513,
      -0.0063,
      -0.0269,
      0.1403,
      0.1126,
      -0.0871,
      -0.0208
    ],
    [
      -0.5552,
      0.0768,
      0.033,
      -0.3895,
      0.058,
      0.0374,
      -0.0198
    ],
    [
      0.053,
      0.1849,
      -0.9577,
      0.1532,
      -0.3448,
      0.0839,
      -0.0882
    ],
    [
      0.2159,
      -0.204,
      -0.3773,
      -0.0484,
      0.1051,
      0.0263,
      0.0296
    ],
    [
      0.9802,
      -0.628,
      -0.1558,
      -0.8727,
      -0.5944,
      -0.4828,
      0.0213
    ],
    [
      -1.8361,
      -1.281,
      -0.0131,
      0.3873,
      -0.3847,
      0.0061,
      0.0755
    ]
  ],
  "lunarCoreLabels": [
    "Coca-Cola",
    "Diet Coke",
    "Coke Zero",
    "Pepsi ",
    "Diet Pepsi",
    "Pepsi Max",
    "Dislike all cola",
    "Don't care"
  ],
  "lunarSurfaceNodes": [
    [
      0.3751,
      -0.1123,
      -0.0964,
      0.2754,
      0.4897,
      -0.0746,
      -0.0617
    ],
    [
      0.2094,
      -0.0341,
      0.2139,
      -0.1387,
      0.2579,
      0.2167,
      -0.0013
    ],
    [
      0.0447,
      0.6026,
      0.4735,
      0.3194,
      -0.1787,
      -0.116,
      0.001
    ],
    [
      -0.756,
      0.759,
      -0.0527,
      -0.3914,
      0.1875,
      -0.0167,
      0.0406
    ],
    [
      -1.7656,
      -0.5529,
      0.0548,
      -0.0776,
      -0.1311,
      -0.0232,
      -0.0432
    ],
    [
      -0.2093,
      -0.4695,
      -0.1126,
      0.431,
      -0.0055,
      0.0455,
      0.0901
    ],
    [
      0.6148,
      -0.1059,
      -0.4776,
      -0.2315,
      -0.1125,
      -0.1246,
      0.0101
    ],
    [
      0.117,
      0.4732,
      -0.3084,
      0.1972,
      -0.3474,
      0.1507,
      -0.0472
    ]
  ],
  "lunarSurfaceLabels": [
    "25 to 29",
    "30 to 34",
    "35 to 39",
    "40 to 44",
    "45 to 49",
    "50 to 54",
    "55 to 64",
    "65 or more"
  ]
}